<h1>Messaging Service</h1>
<p>
  The following account will be used for sending event messages to running instances. The format for the URI is as follows:
  <blockquote>
    URI Schema: proto://user:pass@hostname:port/virtual
    
    <pre>

    protocol     [REQUIRED] Either 'amqp' or 'amqps' depending on if the connection should be Secure (ssl)
    hostname     [REQUIRED] The fully qualified hostname of the server providing AMQP services
    port         [optional] The port to use when connecting to the AMQP service (defaults to 5672 for amqp, and 5671 for ampqs)
    virtual      [optional] The virtual domain path to use when connecting to the AMQP service (defaults to /nimbul)
    </pre>
    
    Example: amqps://amqp.example.com:1234/nimbul
  </blockquote>
</p>

<% form_for :provider_account,
    :url => provider_account_messaging_path(@provider_account),
    :html => { :method => 'post' } do |f| %>
    <%= hidden_field_tag :anchor, :communication %>
    <%= f.error_messages %>
    <table>
    <tr>
        <th>Messaging Server URI</th>
        <td>
          <%= f.text_field :messaging_uri, :class => :long %><br />
          <% if @provider_account.messaging_valid? %>
            <span style="color: green;font-weight: bold;">Messaging Service details appear to be valid.</span>
          <% else %>
            <span style="color: red;font-weight: bold;"><%=@provider_account.errors[:messaging_uri].to_a.join "<br />"%></span>
          <% end %>
        </td>
    </tr>
    <tr>
      <th>Messaging Username (autogenerated)</th>
      <td><input class="long" disabled="disabled" size="30" value="<%=@provider_account.messaging_username%>" type="text"></td>
    </td>
    <tr>
      <th>Messaging Password (autogenerated)</th>
      <td><%= f.text_field :messaging_password, :class => :long, :disabled => true %></td>
    </td>
    <tr>
        <td colspan="2">
        <%= submit_tag "Update", :disable_with => "Updating&hellip;"  %>
        </td>
    </tr>
    </table>
<% end %>

<br />
<%= render :partial => 'publishers/list' %>
